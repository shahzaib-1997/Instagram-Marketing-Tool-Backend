const usernameInput=document.querySelector("#usernameInput"),getAuditBtn=document.querySelector("#getAuditBtn");usernameInput.addEventListener("input",()=>{usernameInput.value?getAuditBtn.disabled=!1:getAuditBtn.disabled=!0});const prevRequestData={username:"",loading:!1,noError:!0};async function getAuditResults(){if(!document.cookie.includes("nitreoEmail"))return $("#myModal").modal();const e=usernameInput.value;if(prevRequestData.username===e&&prevRequestData.noError)return;if(prevRequestData.loading)return;let t;$("#errorMessage").html(""),prevRequestData.loading=!0,$("#getAuditBtn").html('<span class="spinner-grow spinner-grow-sm" /> AUDITING...');try{t=await fetch("https://ig-audit-api.herokuapp.com/audit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.replace(/[^a-zA-Z0-9._]+/g,"")})});const a=await t.json();if(a.error)throw new Error(a.error);$("#mainContent").hide().fadeIn(1500),displayData(a),prevRequestData.noError=!0}catch(e){prevRequestData.noError=!1,e.message.toLowerCase().includes("unexpected")&&(e.message="connection timed out, please try again."),$("#errorMessage").html(`<div class="alert alert-danger small">${e.message}</div>`)}finally{$("#getAuditBtn").html("Audit this account"),prevRequestData.loading=!1,prevRequestData.username=e}}function displayData(e){let{audienceERData:t,audiencePostCountData:a,audienceFollowerRatioData:o,engagementRateData:n,commentRateData:i,likeToCommentRatioData:l,legitimacyRatingData:r,username:s,is_verified:c,profile_pic_url:u,followerCount:m}=e;renderImage(u),$(".legitimacyFlexContainer").css("border-color",r.color),$("#legitimacyScore").html(`<span id="legitimacyScoreValue">${r.value}%</span> <div id="legitimacyScoreBubble" style="background-color: ${r.color}" /> <span>${r.rank}</span>`),counterAnimation(`${r.value}%`,"legitimacyScoreValue"),$("#legitimacyMessage").html(r.message),$(".legitimacyFlexContainer").hide().slideDown(1e3),c?$("#username").html(`${s} <img class="blue-tick" alt="Instagram verified badge" src="https://nitreo.com/img/verified-icon.png" />`):$("#username").text(s),$("#followerCountDiv").html(`<h4 id="followerCount" class="d-inline-block">${m}</h4><span class="h4"> Followers</h4>`),counterAnimation(m,"followerCount");const d=(new Date).toLocaleDateString();$("#auditedOn").text(`Audited on ${d}`),$("#engagementRateScore").html(`<h3>Engagement Rate</h3> <div><span id="engagementRateScoreValue">${n.value}%</span> <div class="scoreBubble" style="background-color:${n.color};" /> ${n.rank}</div>`),$("#engagementRateMessage").html(n.message),counterAnimation(`${n.value}%`,"engagementRateScoreValue"),$("#commentRateScore").html(`<h3>Comment Rate</h3> <div class="rating"><span id="commentRateScoreValue">${i.value}%</span> <div class="scoreBubble" style="background-color:${i.color};" /> ${i.rank}</div>`),$("#commentRateMessage").html(i.message),counterAnimation(`${i.value}%`,"commentRateScoreValue"),$("#likeToCommentRatioScore").html(`<h3>Like - Comment Ratio</h3> <div class="rating"><span id="likeToCommentRatioScoreValue">${l.value}</span> <div class="scoreBubble" style="background-color:${l.color};" /> ${l.rank}</div>`),$("#likeToCommentRatioMessage").html(l.message),counterAnimation(l.value,"likeToCommentRatioScoreValue"),$("#audienceERScore").html(`<h3>Engagement Rate</h3> <div class="rating"><span id="audienceERScoreValue">${t.value}%</span> <div class="scoreBubble" style="background-color:${t.color};" />  ${t.rank}</div>`),$("#audienceERMessage").html(t.message),counterAnimation(`${t.value}%`,"audienceERScoreValue"),$("#audiencePostCountScore").html(`<h3>Audience Post Count</h3> <div class="rating"><span id="audiencePostCountScoreValue">${a.value}</span> <div class="scoreBubble" style="background-color:${a.color};" /> ${a.rank}</div>`),$("#audiencePostCountMessage").html(a.message),counterAnimation(a.value,"audiencePostCountScoreValue"),$("#audienceFollowerRatioScore").html(`<h3>Follower - Following Ratio</h3> <div class="rating"><span id="audienceFollowerRatioScoreValue">${o.value}</span> <div class="scoreBubble" style="background-color:${o.color};" /> ${o.rank}</div>`),$("#audienceFollowerRatioMessage").html(o.message),counterAnimation(o.value,"audienceFollowerRatioScoreValue"),$('[data-toggle="tooltip"]').tooltip()}function loadImage(e){img=document.getElementById("avatar"),img.src=e,img.style.opacity="0"}let intervalID;function checkImageHasLoaded(){img=document.getElementById("avatar"),img.complete&&($("#avatar").css("opacity","0").animate({opacity:1},1500),clearInterval(intervalID))}function renderImage(e){loadImage(e),intervalID=setInterval(checkImageHasLoaded,0)}function writeCookie(e,t,a){let o=new Date;o.setTime(+o+36e5*a),document.cookie=e+"="+t+"; expires="+o.toGMTString()+"; path=/"}document.getElementById("modal-form").addEventListener("submit",function(e){e.preventDefault(),mautic(document.querySelector("#modal-email-input").value)});const counterStep=(e,t,a,o)=>{t<1e3&&!a&&"audienceFollowerRatioScoreValue"!==o?$("#"+o).text(`${Math.ceil(e)}${a}`):"commentRateScoreValue"===o?t<.01?$("#"+o).text("<0.01"):$("#"+o).text(`${e.toFixed(2)}${a}`):$("#"+o).text(`${e.toFixed(1)}${a}`)},counterAnimation=(e,t,a=1500)=>{e=e.toString();const o=Number(e.replace(/[^0-9.]/g,""));let n=e[e.length-1];isNaN(Number(n))||(n=""),$({Counter:0}).animate({Counter:o},{duration:a,easing:"swing",step:function(){counterStep(this.Counter,o,n,t)},complete:function(){counterStep(this.Counter,o,n,t)}})};let mauticLoading=!1;async function mautic(e){if($("#emailErrorMsg").html(""),!mauticLoading){$("#modal-continue").prop("disabled",!0);try{mauticLoading=!0;const t=await fetch("https://ig-audit-api.herokuapp.com/mautic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});(await t.json()).invalidEmail?($("#modal-continue").prop("disabled",!1),$("#emailErrorMsg").html('<div class="alert alert-danger small">Please enter a valid Email</div>')):($("#myModal").modal("toggle"),writeCookie("nitreoEmail",e,"336"),getAuditResults())}catch(e){console.log(e)}finally{mauticLoading=!1}}}