const hashtagInput=document.querySelector("#hashtagInput"),generateHashtagBtn=document.querySelector("#generateHashtagBtn"),hashtagSelect=document.querySelector("#hashtagSelect"),postSelect=document.querySelector("#postSelect");hashtagInput.addEventListener("input",()=>{hashtagInput.value?generateHashtagBtn.disabled=!1:generateHashtagBtn.disabled=!0});const prevRequestData={hashtag:"",postIdx:"",tagIdx:"",noError:!0};let loading=!1;async function getHashtagResults(){if(!document.cookie.includes("nitreoEmail"))return $("#myModal").modal();const t=postSelect.options.selectedIndex,e=hashtagSelect.options.selectedIndex,a=hashtagInput.value,n=postSelect.options[t].value,s=hashtagSelect.options[e].value;if(!loading){$("#errorMessageDiv").html(""),loading=!0,$("#generateHashtagBtn").html('GENERATING <span class="spinner-grow spinner-grow-sm" />');try{const o=await fetch("https://hashtag-generator-api.herokuapp.com/generateHashtags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashtag:a.replace(/[^a-zA-Z0-9_.]+/g,""),postFilter:n,hashtagFilter:s})}),l=await o.json();l.shadowBanned&&$("#errorMessageDiv").html('<div class="alert alert-danger text-danger small">This hashtag is potentially shadow banned and may produce suboptimal results</div>'),l.error?$("#errorMessageDiv").html(`<div class="alert alert-danger text-danger small">${l.error}</div>`):(prevRequestData.noError=!0,displayData(l,prevRequestData.hashtag===a))}catch(t){prevRequestData.noError=!1,$("#errorMessageDiv").html('<div class="alert alert-danger text-danger small">Connection timed out, please try again</div>'),console.log("connection error client",t)}finally{$("#generateHashtagBtn").html("GENERATE"),loading=!1,prevRequestData.hashtag=a,prevRequestData.postIdx=t,prevRequestData.tagIdx=e}}}const displayData=(t,e)=>{renderImage(t.avatar,"avatar"),$("#hashtag").text(`${t.hashtag}`).fadeOut().fadeIn(),$("#postsText").fadeOut().fadeIn();const a=t.totalPosts;let n=a[a.length-1];isNaN(Number(n))||(n=""),$({Counter:0}).animate({Counter:a},{duration:2e3,easing:"swing",step:function(){a<1e3&&!n?$("#postCount").text(`${Math.ceil(this.Counter)}${n}`):$("#postCount").text(`${this.Counter.toFixed(1)}${n}`)},complete:function(){a<1e3&&!n?$("#postCount").text(`${Math.ceil(this.Counter)}${n}`):$("#postCount").text(`${this.Counter.toFixed(1)}${n}`)}}),$("#relatedTagsText").fadeOut().fadeIn(),$("#relatedHashtags").html(""),t.relatedHashtags.length?(t.relatedHashtags.forEach(t=>{$("#relatedHashtags").append(`<a href="#" onclick='(function(){ hashtagInput.value = "${t}" })()'><div class="d-inline-flex badge badge-related text-black-50">#${t} </div></a>`)}),$("#relatedHashtags a").each(function(t){$(this).delay(50*t).fadeOut().fadeIn()}),$("#relatedHashtags ").append('<a class="btn btn-block my-3 btn-primary-light" onclick="copyToClipboard(`relatedHashtags`)">Copy All</a>').fadeOut().fadeIn()):$("#relatedHashtags").append("<small>No Hashtags found</small>"),$("#hashtags").html(""),t.hashtags.length?(t.hashtags.forEach(t=>{$("#hashtags").append(`<a href="#" class="badge badge-hashtag" onclick='(function(){ hashtagInput.value = "${t.replace("#","")}" })()'>${t} </a>`)}),$("#hashtags a").each(function(t){$(this).delay(50*t).fadeOut().fadeIn()}),$("#hashtags").append('<button class="btn btn-primary btn-block my-3" onclick="copyToClipboard(`hashtags`)">Copy All</button>').fadeOut().fadeIn()):$("#hashtags").append("<small>No Hashtags found</small>"),$("#images").html(""),t.images.length&&t.images.forEach(t=>{$("#images").append(`<a href="https://www.instagram.com/p/${t.shortcode}" target="_blank" class="postImg-a">\n\t\t\t\t<img id="${t.shortcode}" class="postImg" src="${t.url}" alt="${t.alt}"/>\n\t\t\t\t</a>`);const e=document.getElementById(t.shortcode);renderImage(e.src,e.id)})},imageIntervals={};function renderImage(t,e){loadImage(t,e);const a=setInterval(()=>checkImageHasLoaded(e),100);imageIntervals[e]=a}function loadImage(t,e){const a=document.getElementById(e);a.src=t,a.style.opacity="0"}function checkImageHasLoaded(t){document.getElementById(t).complete&&($("#"+t).animate({opacity:1},1500),clearInterval(imageIntervals[t]))}function writeCookie(t,e,a){let n=new Date;n.setTime(+n+36e5*a),document.cookie=t+"="+e+"; expires="+n.toGMTString()+"; path=/"}document.getElementById("modal-form").addEventListener("submit",function(t){t.preventDefault(),mautic(document.querySelector("#modal-email-input").value)});const copyToClipboard=t=>{let e=$(`#${t}`).text().replace("Copy All","");if(!e)return;const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)};let mauticLoading=!1;async function mautic(t){if($("#emailErrorMsg").html(""),!mauticLoading){$("#modal-continue").prop("disabled",!0);try{mauticLoading=!0;const e=await fetch("https://hashtag-generator-api.herokuapp.com/mautic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});(await e.json()).invalidEmail?($("#modal-continue").prop("disabled",!1),$("#emailErrorMsg").html('<div class="alert alert-danger small">Please enter a valid Email</div>')):($("#myModal").modal("toggle"),writeCookie("nitreoEmail",t,"336"),getHashtagResults())}catch(t){console.log(t)}finally{mauticLoading=!1}}}